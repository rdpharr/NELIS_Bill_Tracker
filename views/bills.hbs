<h2>{{title}}</h2>
<table id="resultsTable" class="table table-striped table-bordered display responsive" style="width:100%">
    <thead>
    <tr>
        <th>Bill</th>
        <th>Summary</th>
        <th>Introduced</th>
        <th>Most Recent Action</th>
        <th>Hearings</th>
        <th>Bill Tracking</th>
    </tr>
    </thead>
    <tbody>
    {{#each data}}
        <tr>
            <td><a href="https://www.leg.state.nv.us{{this.url}}">{{this.bill}}</a></td>
            <td>{{this.summary}}</td>
            <td>{{dateFormat this.introduced "YYYY-MM-DD"}}</td>
            <td>{{this.most_recent_action}}</td>
            <td>{{this.upcoming_hearings}}</td>
            {{#if this.tracked}}
                <td><input type="button" id="btn_{{this.bill}}" class="btn btn-outline-danger btn-sm" type="button" onclick="toggle_tracking('{{this.bill}}')" value="Untrack"></td>
            {{else}}
                <td><input type="button" id="btn_{{this.bill}}" class="btn btn-outline-primary btn-sm" type="button" onclick="toggle_tracking('{{this.bill}}')" value="Track"></td>
            {{/if}}
        </tr>
    {{/each}}
    </tbody>
</table>
<script>
    $(document).ready(function () {
        $.fn.dataTable.ext.errMode = 'none';
        let table = $('#resultsTable').DataTable({
            fixedHeader: true,
            autoWidth: true,
            dom: 'Bltip',
            order:[2,"desc"],
            buttons: [
                'csvHtml5',
                'excelHtml5',
                'pdfHtml5'
            ],
        });
        $('#resultsTable thead tr').clone(true).appendTo('#resultsTable thead');
        $('#resultsTable thead tr:eq(1) th').each(function (i) {
            var title = $(this).text();
            $(this).html('<input type="text" placeholder="Search ' + title + '" style="width:90%" />');
            $('input', this).on('keyup change', function () {
                if (table.column(i).search() !== this.value) {
                    table
                            .column(i)
                            .search(this.value)
                            .draw();
                }
            });
        });
    });
    function toggle_tracking(bill){
        let btn = $('#btn_' + bill);
        console.log(btn.val());
        if (btn.val()==='Track'){
            document.cookie=bill+"=true;expires=1 Jul 2021 12:00:00 GMT;";
            btn.val("Untrack");
            btn.removeClass("btn-outline-primary");
            btn.addClass("btn-outline-danger");
        } else {
            document.cookie=bill+"=true;Max-Age=-99999999;";
            btn.val("Track");
            btn.removeClass("btn-outline-danger");
            btn.addClass("btn-outline-primary");
        }
    }
</script>
