<h2>{{title}}</h2>
<p>Welcome to the Mass Liberation Project's Nevada Bill Tracker. This page allows you to track bills in the Nevada Legislature with data that's updated every hour. Go to <a href="bills">all bills</a> to start tracking some bills. They will show up in the table below.</p>

<h4>My Bills</h4>
<table id="resultsTable" class="table table-striped table-bordered display responsive" style="width:100%">
    <thead>
    <tr>
        <th>Bill</th>
        <th>Summary</th>
        <th>Introduced</th>
        <th>Most Recent Action</th>
        <th>Hearings</th>
        <th>Bill Tracking</th>
    </tr>
    </thead>
    <tbody>
    {{#each my_bills}}
        <tr>
            <td><a href="https://www.leg.state.nv.us{{this.url}}">{{this.bill}}</a></td>
            <td>{{this.summary}}</td>
            <td>{{dateFormat this.introduced "YYYY-MM-DD"}}</td>
            <td>{{this.most_recent_action}}</td>
            <td>{{this.upcoming_hearings}}</td>
            {{#if this.tracked}}
                <td><button id="btn_{{this.bill}}" class="btn btn-outline-danger btn-sm" type="button" onclick='document.cookie="{{this.bill}}=true;Max-Age=-99999999;";window.location.reload();'>Untrack</button></td>
            {{else}}
                <td><button id="btn_{{this.bill}}" class="btn btn-outline-primary btn-sm" type="button" onclick='document.cookie="{{this.bill}}=true;expires=1 Jul 2021 12:00:00 GMT;";window.location.reload();'>Track</button></td>
            {{/if}}
        </tr>
    {{/each}}
    </tbody>
</table>
<script>
    $(document).ready(function () {
        $.fn.dataTable.ext.errMode = 'none';
        let table = $('#resultsTable').DataTable({
            fixedHeader: true,
            autoWidth: true,
            dom: 'Bltip',
            buttons: [
                'csvHtml5',
                'excelHtml5',
                'pdfHtml5'
            ],
        });
        $('#resultsTable thead tr').clone(true).appendTo('#resultsTable thead');
        $('#resultsTable thead tr:eq(1) th').each(function (i) {
            var title = $(this).text();
            $(this).html('<input type="text" placeholder="Search ' + title + '" style="width:90%" />');
            $('input', this).on('keyup change', function () {
                if (table.column(i).search() !== this.value) {
                    table
                            .column(i)
                            .search(this.value)
                            .draw();
                }
            });
        });
    });
</script>
